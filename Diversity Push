/* 
get full list

Drop from full list, contacts that have verified race data

delete race records that are different from full list

insert the leftovers on the full list

Question: Push to master record, or all records in a cluster?
Question: how does merging affect these records? the Verified ones should remain
*/

Create temporary table full_list as (
select 
uc.id as contact__c,
--uc.name, 
--uc.auto_contact_number__c, 
--pc.id, pc.namex, pc.auto_contact_number, d.race, d.race_confidence, 
'Race' as Type__c, 
Case when race ilike '%white%' then 'White'
when race ilike '%Black%' then 'Black'
when race ilike '%hispanic%' then 'Latinx'
when race ilike '%asian%' then 'AAPI'
when race ilike '%other%' then 'Other'
when race ilike '%indigenous%' then 'Indigenous'
when race ilike '%Arab%' then 'Middle Eastern'
when race ilike '%pacific%' then 'AAPI'
when race ilike '%Hawai%' then 'Other'
else 'Other' end as subtype__c,
Case when race_confidence = 'Self-Reported' then 'Self Reported'
else 'Catalist' end as source__c,
Case 
when race_confidence = 'Self-Reported' then 'Verified'
when race_confidence = 'HighlyLikely' then 'Highly Likely'
when race_confidence = 'Likely' then 'Likely'
else null end as Confidence__c
From rounddata_dev.uat_contacts uc
join rounddata.contact pc on uc.auto_contact_number__c = pc.auto_contact_number
join idres_analytics.current_customer_graph idr on pc.id = idr.source_primary_key
join ppfa_golden.golden_diversity d on idr.resolved_id = d.resolved_id
where race_confidence in ('Self-Reported','HighlyLikely','Likely') );

select * from full_list;