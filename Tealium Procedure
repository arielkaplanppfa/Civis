create or replace procedure akaplan.tealium_rename(tablename varchar) 

LANGUAGE plpgsql

as $$

declare loop_count integer := 1;

declare old varchar ;
declare new varchar ;
declare tbl varchar := tablename;

begin

 <<tealium_rename>>

LOOP

old = (select column_name from information_schema.columns where table_schema = 'tealium_staging' and table_name = quote_ident(tbl) 
       and ( column_name like '% %' or column_name like '%-%' or column_name like '%)%' or column_name like '%(%' ) limit 1);

new = replace(replace(replace(replace(quote_ident(old),' - ', '_'),' ','_'),')',''),'(','') ;

Execute 'Alter table tealium_staging."'||quote_ident(tbl)||'" rename column '||quote_ident(old)||' to '||quote_ident(new) ;


loop_count:= loop_count + 1;

EXIT tealium_rename WHEN (loop_count > 5);



END LOOP;



END;

$$;